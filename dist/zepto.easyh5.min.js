/*! zepto.easyh5 作者:zhongwang；日期:2016-04-19；email:webzhongwang@gmail.com；*/
!function(a,c){function d(a,b,c){var d=null;b>0&&(d=a.find(".easyh5-pre")),0>b&&(d=a.find(".easyh5-next")),d.addClass("easyh5-active");var f=b>0?b-a.height():b+a.height();d.css({"-webkit-transform":"translateY("+f+"px);",transform:"translateY("+f+"px);"}),e(d)}function e(b){var c=a(b.find("[delay]"));a.each(c,function(b,c){var d=a(c),e=parseFloat(d.attr("delay"))?parseFloat(d.attr("delay")):0,f=parseFloat(d.attr("duration"));d.addClass(d.attr("anim-class")),c.style.webkitAnimationDelay=e+"s",c.style.animationDelay=e+"s",f&&(c.style.webkitAnimationDuration=f+"s",c.style.animationDuration=f+"s")})}function f(a){this.ininSetting(a),this.initEvent()}function g(a,b){this.$node=a,f.call(this,b)}if("undefined"==typeof a)throw new Error("Easyh5 requires Zepto");var h=null,i={start:0,duration:300,loop:!0,auto:!1,dir:"top",autoDuration:5,showPageNum:!0,pageNumPlace:"right-bottom",audio:!1,showAudio:!0,audioSrc:"http://mp3.9ku.com/mp3/540/539742.mp3",width:320,height:480,persent:.15};g.prototype={initEvent:function(){this.touchstart(),this.touchmove(),this.touchend(),this.autoPlay(),this.orientationchange()},ininSetting:function(b){var c=this,d=c.$node;c.options=a.extend({},i,b),c.settings={currentIndex:c.options.start,page:".easyh5-page",autoTimer:null},c.settings.size=d.find(c.settings.page).length,c.initArrow(),c.initAudio(),c.resetContent(),c.resetView(),c.initLoading(),c.resetPlacement(),c.resetPageNum();var f=a(c.$node.find(this.settings.page)[c.settings.currentIndex]);f.addClass("easyh5-current"),e(f)},touchstart:function(){var a=this;this.$node.on("touchstart",function(b){a.startX=b.targetTouches[0].clientX,a.startY=b.targetTouches[0].clientY,a.resetStyle(),a.resetClass(),clearInterval(a.settings.autoTimer)})},touchmove:function(){var a=this;this.$node.on("touchmove",function(b){b.stopPropagation(),b.preventDefault();var c=b.changedTouches[0].clientY-a.startY;a.checkLoop(c)&&d(a.$node,c,a)})},touchend:function(){var a=this;this.$node.on("touchend",function(b){var c=b.changedTouches[0].clientY-a.startY,d=c/a.$node.height(),e=0;Math.abs(d)>=a.options.persent&&(0>d&&(e=1),d>0&&(e=-1)),a.checkLoop(c)&&a.moveTo(a.settings.currentIndex+e),a.autoPlay()})},initArrow:function(){var a='<div class="easyh5-arrow">                         <div class="easyh5-arrow-in">                             <span class="easyh5-arrow-l"><i></i></span>                             <span class="easyh5-arrow-r"><i></i></span>                         </div>                     </div>';this.$node.append(a)},initLoading:function(){a(this.$node.find(".easyh5-page")).css({opacity:1})},initAudio:function(){if(!this.options.audio)return!1;if(this.options.showAudio){var a='<i class="easyh5-audio"></i>';this.$node.append(a)}var b='<audio loop="loop" autoplay="autoplay" src="'+this.options.audioSrc+'"></audio>';this.$node.append(b)},resetPageNum:function(){if(!this.options.showPageNum)return!1;var b=null,c=this.settings.currentIndex+1+"/"+this.settings.size;this.$node.find(".easyh5-mask").size()?a(this.$node.find(".easyh5-mask")).text(c):(b='<span class="easyh5-mask '+this.options.pageNumPlace+'">'+c+"</span>",this.$node.append(b))},autoPlay:function(){var a=this,b=this.options.dir;return a.options.auto?void(a.settings.autoTimer=setInterval(function(){"top"==b?a.moveTo(a.settings.currentIndex+1):"bottom"==b&&a.moveTo(a.settings.currentIndex-1)},1e3*a.options.autoDuration)):!1},resetView:function(){var c=this,d=c.$node,e=a(d.find(".easyh5-content")),f=c.options.width,g=c.options.height;windowWidth=d.width(),windowHeight=d.height(),scale=1,b=f/g,windowB=windowWidth/windowHeight,dl=(windowWidth-f)/2,dt=(windowHeight-g)/2,e.css({width:f,height:g}),b<=windowB?scale=windowHeight/g:scale=windowWidth/f,e.css({left:dl+"px",top:dt+"px","-webkit-transform":"scale("+scale+")",transform:"scale("+scale+")"})},resetPlacement:function(){var b=this,c=b.$node,d=a(c.find(this.settings.page)),e=b.settings.currentIndex,f=e-1,g=e+1;0>f&&(f=b.settings.size-1),g>=b.settings.size&&(g=0),a(c.find(".easyh5-pre")).removeClass("easyh5-pre"),a(c.find(".easyh5-next")).removeClass("easyh5-next"),a(d[f]).addClass("easyh5-pre"),a(d[g]).addClass("easyh5-next"),b.clearPageAnim(a(d[f])),b.clearPageAnim(a(d[g]))},resetStyle:function(){a(this.$node.find(this.settings.page)).css({"-webkit-transition":"",transition:""})},resetClass:function(){a(this.$node.find(".easyh5-active")).removeClass("easyh5-active"),a(this.$node.find(".easyh5-anim")).removeClass("easyh5-anim")},resetContent:function(){var b=this.$node,c=b.find(".easyh5-page");a.each(c,function(b,c){var d=c.innerHTML;a(c).html('<div class="easyh5-content"></div>'),a(a(c).find(".easyh5-content")).html(d)})},checkLoop:function(a){var b=!0;return this.options.loop||(0==this.settings.currentIndex&&a>0&&(b=!1),this.settings.currentIndex==this.settings.size-1&&0>a&&(b=!1)),b},clearPageAnim:function(b){$eles=a(b.find("[delay]")),a.each($eles,function(b,c){var d=a(c),e=d.attr("anim-class"),f=d.attr("class");f=f.replace(e,""),c.className=f}),$eles.css({"-webkit-animation":"","animation-delay":""})},clearPageStyle:function(a){a.css({"-webkit-transition":"",transition:"","-webkit-transform":"",transform:""})},moveTo:function(b){var c=this,d=c.$node;if(b==c.settings.currentIndex)a(d.find(".easyh5-active")).addClass("easyh5-anim").css({"-webkit-transform":"",transform:""}),setTimeout(function(){c.resetPlacement()},c.options.duration);else{0>b&&(b=c.settings.size-1),b>=c.settings.size&&(b=0),c.settings.currentIndex=b,e(a(d.find(".easyh5-page")[b]));var f=a(d.find(this.settings.page)[b]);f.addClass("easyh5-active"),f.css({"-webkit-transition":"-webkit-transform "+c.options.duration/1e3+"s ease-in-out",transition:"transform "+c.options.duration/1e3+"s ease-in-out","-webkit-transform":"translateY(0);",transform:"translateY(0);"}),setTimeout(function(){a(d.find(".easyh5-current")).removeClass("easyh5-current"),f.addClass("easyh5-current"),f.removeClass("easyh5-active"),c.clearPageStyle(f),c.resetPlacement(),c.resetPageNum()},c.options.duration)}},orientationchange:function(){var b=this;a(c).on("orientationchange",function(a){setTimeout(function(){b.resetView()},30)})}},a.fn.easyh5=function(b){return h||(h=new g(a(this),b)),this}}(Zepto,window);